var allianceFiveHeroes = ['<b class="alliance">5-SirConrad</b>', '<b class="alliance">5-LoneHero</b>', '<b class="alliance">5-BlueHat</b>', '<b class="alliance">5-Olivia</b>',
    '<b class="alliance">5-BattleFury</b>', '<b class="alliance">5-Paladin</b>', '<b class="alliance">5-BlackBeard</b>', '<b class="alliance">5-Radolf</b>',
    '<b class="alliance">5-KingLionheart</b>', '<b class="alliance a-tier tesla">5-Tesla</b>', '<b class="alliance a-tier samurai">5-Samurai</b>', '<b class="alliance mulan a-tier">5-Mulan</b>',
    '<b class="alliance a-tier saw-machine">5-SawMachine</b>', '<b class="alliance a-tier ultima">5-Ultima</b>', '<b class="alliance vivienne a-tier">5-Vivienne</b>', '<b class="alliance martin a-tier">5-Martin</b>',
    '<b class="alliance epic valkyrie">5-Valkyrie</b>'];

var hordeFiveHeroes = ['<b class="horde">5-OrcWarrior</b>', '<b class="horde">5-Murloc</b>', '<b class="horde">5-Khalil</b>',
    '<b class="horde">5-WitchDoctor</b>', '<b class="horde">5-EagleEyeShaman</b>', '<b class="horde b-tier rlyeh">5-Rlyeh</b>', '<b class="horde">5-Ogre</b>',
    '<b class="horde">5-ShamanAssasin</b>', '<b class="horde b-tier wolf-rider">5-WolfRider</b>', '<b class="horde">5-SwordMaster</b>', '<b class="horde scarlet a-tier">5-Scarlet</b>',
    '<b class="horde b-tier minotaur">5-Minotaur</b>', '<b class="horde b-tier abyss-lord">5-AbyssLord</b>', '<b class="horde medusa a-tier">5-Medusa</b>', '<b class="bloodtooth horde a-tier">5-BloodTooth</b>',
    '<b class="horde a-tier lexar">5-Lexar</b>', '<b class="horde epic phoenix">5-Phoenix</b>'];

var elvesFiveHeroes = ['<b class="elves b-tier megaw">5-MegaW</b>', '<b class="elves">5-Treant</b>', '<b class="elves b-tier werewolf">5-Werewolf</b>',
    '<b class="elves">5-Shaly</b>', '<b class="elves">5-ForestHealer</b>', '<b class="elves">5-MiKun</b>', '<b class="elves">5-Amy</b>', '<b class="elves">5-Rossetti</b>',
    '<b class="elves b-tier orphee">5-Orphee</b>', '<b class="elves vegvisir a-tier">5-Vegvisir</b>', '<b class="elves centaur b-tier">5-Centaur</b>', '<b class="elves tiger-king b-tier">5-TigerKing</b>', '<b class="elves">5-DemonFighter</b>',
    '<b class="elves a-tier grand">5-Grand</b>', '<b class="elves luna a-tier">5-Luna</b>', '<b class="elves drow epic">5-Drow</b>'];

var undeadFiveHeroes = ['<b class="undead">5-Frankenstein</b>', '<b class="undead">5-PumpkinSoldier</b>',
    '<b class="undead">5-ChemicalButcher</b>', '<b class="undead">5-Forren</b>', '<b class="undead">5-Anubis</b>', '<b class="undead">5-CrowArcher</b>', '<b class="undead">5-PuppetMaid</b>',
    '<b class="undead">5-Exdeath</b>', '<b class="undead a-tier hester">5-Hester</b>', '<b class="undead b-tier dziewona">5-Dziewona</b>', '<b class="undead wolnir a-tier">5-Wolnir</b>', '<b class="undead">5-CursedOne</b>',
    '<b class="undead b-tier gerald">5-Gerald</b>', '<b class="undead a-tier reaper">5-Reaper</b>', '<b class="undead aden a-tier">5-Aden</b>', '<b class="undead ripper a-tier">5-Ripper</b>', '<b class="undead shudde-m-ell epic">5-ShuddeMell</b>',
    '<b class="undead a-tier dettlaff">5-Dettlaff</b>'];

var heavenHellFiveHeroes = ['<b class="heaven">5-GoldenPastor</b>', '<b class="heaven">5-Morgenstern</b>', '<b class="heaven">5-HeavenJudge</b>', '<b class="heaven verthandi a-tier">5-Verthandi</b>',
    '<b class="heaven nameless-king epic">5-NamelessKing</b>', '<b class="heaven mars epic">5-Mars</b>', '<b class="heaven lindberg epic">5-Lindberg</b>', '<b class="heaven skuld epic">5-Skuld</b>', '<b class="hell">5-Belial</b>',
    '<b class="hell">5-Aurelle</b>', '<b class="hell">5-DarkJudge</b>', '<b class="hell freya a-tier">5-Freya</b>', '<b class="hell monkey-king epic">5-MonkeyKing</b>', '<b class="hell chessia epic">5-Chessia</b>',
    '<b class="hell xexanoth epic">5-Xexanoth</b>'];

var allianceFourHeroes = ['<span class="alliance">4-SirConrad</span>', '<span class="alliance">4-LoneHero</span>', '<span class="alliance">4-BlueHat</span>',
    '<span class="alliance">4-Olivia</span>', '<span class="alliance">4-BattleFury</span>', '<span class="alliance">4-Paladin</span>',
    '<span class="alliance">4-BlackBeard</span>', '<span class="alliance">4-Radolf</span>'];

var hordeFourHeroes = ['<span class="horde">4-OrcWarrior</span>',
    '<span class="horde">4-Murloc</span>', '<span class="horde">4-Khalil</span>', '<span class="horde">4-WitchDoctor</span>', '<span class="horde">4-EagleEyeShaman</span>',
    '<span class="horde">4-Rlyeh</span>', '<span class="horde">4-Ogre</span>', '<span class="horde">4-ShamanAssasin</span>'];

var elvesFourHeroes = ['<span class="elves">4-MegaW</span>',
    '<span class="elves">4-Treant</span>', '<span class="elves">4-Werewolf</span>', '<span class="elves">4-Shaly</span>', '<span class="elves">4-ForestHealer</span>',
    '<span class="elves">4-MiKun</span>', '<span class="elves">4-Amy</span>', '<span class="elves">4-Rossetti</span>'];

var undeadFourHeroes = ['<span class="undead">4-Frankenstein</span>',
    '<span class="undead">4-PumpkinSoldier</span>', '<span class="undead">4-ChemicalButcher</span>', '<span class="undead">4-Forren</span>', '<span class="undead">4-Anubis</span>',
    '<span class="undead">4-CrowArcher</span>', '<span class="undead">4-PuppetMaid</span>', '<span class="undead">4-Exdeath</span>'];

var heavenHellFourHeroes = ['<span class="heaven">4-GoldenPastor</span>',
    '<span class="heaven">4-Morgenstern</span>', '<span class="heaven">4-HeavenJudge</span>', '<span class="hell">4-Belial</span>', '<span class="hell">4-Aurelle</span>',
    '<span class="hell">4-DarkJudge</span>'];

var arrayShuffle = function(array) {
    for ( var i = 0, length = array.length, swap = 0, temp = ''; i < length; i++ ) {
        swap        = Math.floor(Math.random() * (i + 1));
        temp        = array[swap];
        array[swap] = array[i];
        array[i]    = temp;
    }
    return array;
};

var percentageChance = function(values, chances) {
    for ( var i = 0, pool = []; i < chances.length; i++ ) {
        for ( var i2 = 0; i2 < chances[i]; i2++ ) {
            pool.push(i);
        }
    }
    return values[arrayShuffle(pool)['0']];
};

var randomFromTo = function (from, to) {
    return Math.floor(Math.random() * (to - from + 1) + from);
};

var getRandomHero = function(array) {
    var hero = array[Math.floor(Math.random() * array.length)],
        calc = Math.random() * 10,
        heavenHellChance;

    if (hero.includes("epic")) {
        calc = Math.random() * 10;
        heavenHellChance = (hero.includes('heaven') || hero.includes('hell')) ? 0.45 : 0.30;
        if (calc > heavenHellChance) {
            do {
                hero = arrayShuffle(array[Math.floor(Math.random() * array.length)]);
                console.log('in while - '+hero)
            } while (hero.includes('epic'));
        }
    }

    if (hero.includes("a-tier")) {
        calc = Math.random() * 10;
        heavenHellChance = (hero.includes('heaven') || hero.includes('hell')) ? 4.5 : 2.3;
        if (calc > heavenHellChance) {
            do {
                hero = arrayShuffle(array[Math.floor(Math.random() * array.length)]);
            } while (hero.includes('a-tier'));
        }
    }

    if (hero.includes("b-tier")) {
        calc = Math.random() * 10;
        if (calc > 4) {
            do {
                hero = arrayShuffle(array[Math.floor(Math.random() * array.length)]);
            } while (hero.includes('b-tier'));
        }
    }

    return hero;
};

var getHeroReward = function(whatHero, faction) {
    var reward = '',
        reCalc = Math.random() * 100;
    switch (true) {
        case (faction === 'alliance' && whatHero === 'five-hero'):
            reward = getRandomHero(arrayShuffle(allianceFiveHeroes));
            break;
        case (faction === 'horde' && whatHero === 'five-hero'):
            reward = getRandomHero(arrayShuffle(hordeFiveHeroes));
            break;
        case (faction === 'elves' && whatHero === 'five-hero'):
            reward = getRandomHero(arrayShuffle(elvesFiveHeroes));
            break;
        case (faction === 'undead' && whatHero === 'five-hero'):
            reward = getRandomHero(arrayShuffle(undeadFiveHeroes));
            break;
        case (faction === 'heaven-hell' && whatHero === 'five-hero'):
            reward = getRandomHero(arrayShuffle(heavenHellFiveHeroes));
            if (reCalc >= 40) {
                do {
                    reward = getRandomHero(arrayShuffle(heavenHellFiveHeroes));
                } while (reward.includes('heaven'));
            }
            break;
        case (faction === 'alliance' && whatHero === 'four-hero'):
            reward = getRandomHero(arrayShuffle(allianceFourHeroes));
            break;
        case (faction === 'horde' && whatHero === 'four-hero'):
            reward = getRandomHero(arrayShuffle(hordeFourHeroes));
            break;
        case (faction === 'elves' && whatHero === 'four-hero'):
            reward = getRandomHero(arrayShuffle(elvesFourHeroes));
            break;
        case (faction === 'undead' && whatHero === 'four-hero'):
            reward = getRandomHero(arrayShuffle(undeadFourHeroes));
            break;
        case (faction === 'heaven-hell' && whatHero === 'four-hero'):
            reward = getRandomHero(arrayShuffle(heavenHellFourHeroes));
            if (reCalc >= 40) {
                do {
                    reward = getRandomHero(arrayShuffle(heavenHellFourHeroes));
                } while (reward.includes('heaven'));
            }
            break;
    }

    return reward;
};

$(document).on('click', '.switches > span', function() {
    $(this).parent().find('> span').removeClass('active');
    $(this).addClass('active');
});

$(document).on('click', '.factions > button', function() {
    var clicked = $(this),
        faction = clicked.attr('data-faction'),
        fiveHeroChance = clicked.attr('data-chance-5-hero'),
        fiveShardChance = clicked.attr('data-chance-5-shard'),
        fourHeroChance = clicked.attr('data-chance-4-hero'),
        fourShardChance = clicked.attr('data-chance-4-shard'),
        numberOfPulls = parseInt($('.switches > span.active').attr('data-pull')),
        item = '',
        counter,
        shardReward,
        heroReward,
        convertReward = 0,
        className,
        reCalc = Math.random() * 100;

    $('.reward').html('');

    for (i = 1; i <= numberOfPulls; i++) {
        item = percentageChance(['five-hero', 'five-shard', 'four-hero', 'four-shard'], [fiveHeroChance, fiveShardChance, fourHeroChance, fourShardChance]);
        counter = $(".totals ."+faction+"-"+item+" .counter");
        console.log(".totals ."+faction+"-"+item+" .counter");
        convertReward += parseInt(randomFromTo(12, 29));

        switch (true) {
            case (item === 'four-shard'):
                var amount = 1;
                if (faction === 'heaven-hell') {
                    if (reCalc >= 40) {
                        counter = $('.'+faction+'-'+item+'.hell .counter');
                    } else {
                        counter = $('.'+faction+'-'+item+'.heaven .counter');
                    }
                }
                counter.html(parseInt(counter.html()) + amount);
                $('.reward').append(item+'('+amount+') / ');
                break;
            case (item === 'five-hero' || item === 'four-hero'):
                heroReward = getHeroReward(item, faction).replace('5-', '').replace('4-', '');
                if (heroReward.includes('heaven')) {
                    counter = $('.'+faction+'-'+item+'.heaven .counter');
                } else if (heroReward.includes('hell')) {
                    counter = $('.'+faction+'-'+item+'.hell .counter');
                }

                if (heroReward.includes('epic')) {
                    counter = $('.totals .happy');
                } else if (heroReward.includes('a-tier')) {
                    counter = $('.totals .heroes');
                }
                console.log(counter);
                counter.append(heroReward + ' / ');
                $('.reward').append(item+' / ');
                break;
            case (item === 'five-shard'):
                shardReward = randomFromTo(7, 14);
                $('.totals .five-star-shards .counter').html(parseInt($('.totals .five-star-shards .counter').html()) + parseInt(shardReward));
                $('.reward').append(item+'('+shardReward+') / ');
                break;
        }

        console.log(item+' '+faction);
    }

    $('.reward').append('CONVERT SHARDS: '+convertReward);
    $('.totals .convert-shards .counter').html(parseInt($('.totals .convert-shards .counter').html()) + convertReward);
    $('.number-of-pulls .counter').html(parseInt($('.number-of-pulls .counter').html()) + numberOfPulls);
});